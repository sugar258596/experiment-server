# è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯æ¥å£

## ğŸ“‹ æ¦‚è¿°

ç³»ç»Ÿæä¾›äº†**ä¸¤ä¸ªæ¥å£**æ¥è·å–å½“å‰ç™»å½•ç”¨æˆ·çš„ä¿¡æ¯ï¼Œåˆ†åˆ«é€‚ç”¨äºä¸åŒçš„ä½¿ç”¨åœºæ™¯ã€‚

---

## ğŸ” è®¤è¯æ–¹å¼

æ‰€æœ‰æ¥å£éƒ½éœ€è¦æºå¸¦ **JWT Token** è¿›è¡Œè®¤è¯:

```http
Authorization: Bearer <your-jwt-token>
```

---

## ğŸ“¡ æ¥å£åˆ—è¡¨

### 1. è·å–è¯¦ç»†ç”¨æˆ·ä¿¡æ¯

#### æ¥å£ä¿¡æ¯

- **è·¯å¾„**: `GET /user/profile`
- **è®¤è¯**: éœ€è¦ JWT Token
- **æƒé™**: æ‰€æœ‰ç™»å½•ç”¨æˆ·
- **è¿”å›**: å®Œæ•´çš„ç”¨æˆ·ä¿¡æ¯

#### è¯·æ±‚ç¤ºä¾‹

```bash
curl -X GET http://localhost:3000/user/profile \
  -H "Authorization: Bearer <your-jwt-token>" \
  -H "Content-Type: application/json"
```

#### å“åº”ç¤ºä¾‹ (200 OK)

```json
{
  "id": 1,
  "username": "zhangsan",
  "nickname": "å¼ ä¸‰",
  "avatar": "https://example.com/avatar.jpg",
  "email": "zhangsan@example.com",
  "phone": "13800138000",
  "department": "è®¡ç®—æœºç§‘å­¦ä¸æŠ€æœ¯å­¦é™¢",
  "role": "student",
  "status": "ACTIVE",
  "teachingTags": ["Python", "æœºå™¨å­¦ä¹ "],
  "auditTimeSlots": {
    "morning": "09:00-12:00",
    "afternoon": "14:00-17:00"
  },
  "createdAt": "2025-11-07T10:00:00.000Z",
  "updatedAt": "2025-11-07T10:00:00.000Z"
}
```

#### å“åº”å­—æ®µè¯´æ˜

| å­—æ®µå           | ç±»å‹     | å¿…å¡« | è¯´æ˜                |
| ---------------- | -------- | ---- | ------------------- |
| `id`             | number   | æ˜¯   | ç”¨æˆ·ID              |
| `username`       | string   | æ˜¯   | ç”¨æˆ·å              |
| `nickname`       | string   | å¦   | ç”¨æˆ·æ˜µç§°            |
| `avatar`         | string   | å¦   | ç”¨æˆ·å¤´åƒURL         |
| `email`          | string   | å¦   | ç”¨æˆ·é‚®ç®±            |
| `phone`          | string   | å¦   | ç”¨æˆ·æ‰‹æœºå·          |
| `department`     | string   | å¦   | æ‰€å±é™¢ç³»/éƒ¨é—¨       |
| `role`           | string   | æ˜¯   | ç”¨æˆ·è§’è‰²            |
| `status`         | string   | æ˜¯   | ç”¨æˆ·çŠ¶æ€            |
| `teachingTags`   | string[] | å¦   | æ•™å­¦æ ‡ç­¾æ•°ç»„        |
| `auditTimeSlots` | object   | å¦   | å®¡æ ¸æ—¶é—´æ®µé…ç½®      |
| `createdAt`      | string   | æ˜¯   | åˆ›å»ºæ—¶é—´ (ISO 8601) |
| `updatedAt`      | string   | æ˜¯   | æ›´æ–°æ—¶é—´ (ISO 8601) |

#### è§’è‰²å€¼è¯´æ˜

- `student` - å­¦ç”Ÿ
- `teacher` - æ•™å¸ˆ
- `admin` - ç®¡ç†å‘˜
- `super_admin` - è¶…çº§ç®¡ç†å‘˜

#### çŠ¶æ€å€¼è¯´æ˜

- `ACTIVE` - æ­£å¸¸
- `INACTIVE` - ç¦ç”¨
- `BANNED` - å°ç¦

---

### 2. è·å–ç®€åŒ–ç”¨æˆ·ä¿¡æ¯

#### æ¥å£ä¿¡æ¯

- **è·¯å¾„**: `GET /user/me`
- **è®¤è¯**: éœ€è¦ JWT Token
- **æƒé™**: æ‰€æœ‰ç™»å½•ç”¨æˆ·
- **è¿”å›**: ç®€åŒ–çš„ç”¨æˆ·ä¿¡æ¯

#### è¯·æ±‚ç¤ºä¾‹

```bash
curl -X GET http://localhost:3000/user/me \
  -H "Authorization: Bearer <your-jwt-token>" \
  -H "Content-Type: application/json"
```

#### å“åº”ç¤ºä¾‹ (200 OK)

```json
{
  "id": 1,
  "username": "zhangsan",
  "nickname": "å¼ ä¸‰",
  "role": "student",
  "status": "ACTIVE"
}
```

#### å“åº”å­—æ®µè¯´æ˜

| å­—æ®µå     | ç±»å‹   | å¿…å¡« | è¯´æ˜     |
| ---------- | ------ | ---- | -------- |
| `id`       | number | æ˜¯   | ç”¨æˆ·ID   |
| `username` | string | æ˜¯   | ç”¨æˆ·å   |
| `nickname` | string | å¦   | ç”¨æˆ·æ˜µç§° |
| `role`     | string | æ˜¯   | ç”¨æˆ·è§’è‰² |
| `status`   | string | æ˜¯   | ç”¨æˆ·çŠ¶æ€ |

---

## âŒ é”™è¯¯å“åº”

### 401 Unauthorized - æœªæˆæƒè®¿é—®

```json
{
  "statusCode": 401,
  "message": "Unauthorized",
  "timestamp": "2025-11-08T01:45:00.000Z"
}
```

**åŸå› **: æœªæä¾›æˆ–æä¾›äº†æ— æ•ˆçš„ JWT Token

**è§£å†³æ–¹æ¡ˆ**:

1. ç¡®ä¿åœ¨è¯·æ±‚å¤´ä¸­æºå¸¦äº†æœ‰æ•ˆçš„ `Authorization: Bearer <token>`
2. æ£€æŸ¥ Token æ˜¯å¦å·²è¿‡æœŸ
3. é‡æ–°ç™»å½•è·å–æ–°çš„ Token

### 404 Not Found - ç”¨æˆ·ä¸å­˜åœ¨

```json
{
  "statusCode": 404,
  "message": "ç”¨æˆ·ä¸å­˜åœ¨",
  "timestamp": "2025-11-08T01:45:00.000Z"
}
```

**åŸå› **: Token ä¸­åŒ…å«çš„ç”¨æˆ·IDåœ¨æ•°æ®åº“ä¸­ä¸å­˜åœ¨

**è§£å†³æ–¹æ¡ˆ**:

1. æ£€æŸ¥ Token çš„æœ‰æ•ˆæ€§
2. è”ç³»ç®¡ç†å‘˜æ£€æŸ¥ç”¨æˆ·è´¦æˆ·çŠ¶æ€

---

## ğŸ’¡ ä½¿ç”¨å»ºè®®

### ä»€ä¹ˆæ—¶å€™ä½¿ç”¨ `/user/profile`ï¼Ÿ

- éœ€è¦æ˜¾ç¤ºå®Œæ•´çš„ç”¨æˆ·ä¿¡æ¯(å¦‚ä¸ªäººèµ„æ–™é¡µé¢)
- éœ€è¦è·å–ç”¨æˆ·çš„é¢å¤–ä¿¡æ¯(é‚®ç®±ã€ç”µè¯ã€éƒ¨é—¨ç­‰)
- éœ€è¦è®¿é—®ç”¨æˆ·çš„æ•™å­¦æ ‡ç­¾å’Œå®¡æ ¸æ—¶é—´æ®µé…ç½®
- éœ€è¦æ˜¾ç¤ºç”¨æˆ·çš„åˆ›å»ºå’Œæ›´æ–°æ—¶é—´

### ä»€ä¹ˆæ—¶å€™ä½¿ç”¨ `/user/me`ï¼Ÿ

- åªéœ€è¦æ˜¾ç¤ºåŸºæœ¬çš„ç”¨æˆ·ä¿¡æ¯(å¦‚å¯¼èˆªæ ç”¨æˆ·å)
- æ€§èƒ½æ•æ„Ÿçš„åœºæ™¯ï¼Œéœ€è¦å‡å°‘æ•°æ®ä¼ è¾“é‡
- å¿«é€Ÿæ£€æŸ¥ç”¨æˆ·èº«ä»½å’ŒçŠ¶æ€
- ä½œä¸ºç”¨æˆ·è®¤è¯çŠ¶æ€çš„å‰ç«¯æ£€æŸ¥

---

## ğŸ” å‰ç«¯ä½¿ç”¨ç¤ºä¾‹

### JavaScript (React/Vue/Angular)

```javascript
// è·å–å®Œæ•´ç”¨æˆ·ä¿¡æ¯
const getUserProfile = async () => {
  try {
    const response = await fetch('/user/profile', {
      headers: {
        Authorization: `Bearer ${localStorage.getItem('token')}`,
      },
    });
    const user = await response.json();
    console.log('ç”¨æˆ·ä¿¡æ¯:', user);
  } catch (error) {
    console.error('è·å–ç”¨æˆ·ä¿¡æ¯å¤±è´¥:', error);
  }
};

// è·å–ç®€åŒ–ç”¨æˆ·ä¿¡æ¯
const getCurrentUser = async () => {
  try {
    const response = await fetch('/user/me', {
      headers: {
        Authorization: `Bearer ${localStorage.getItem('token')}`,
      },
    });
    const user = await response.json();
    // æ›´æ–°å‰ç«¯çŠ¶æ€
    setCurrentUser(user);
  } catch (error) {
    console.error('è·å–å½“å‰ç”¨æˆ·å¤±è´¥:', error);
  }
};
```

### Vue.js

```vue
<script>
export default {
  data() {
    return {
      user: null,
    };
  },
  async created() {
    await this.loadUserProfile();
  },
  methods: {
    async loadUserProfile() {
      try {
        const response = await this.$http.get('/user/me', {
          headers: {
            Authorization: `Bearer ${this.$store.getters.token}`,
          },
        });
        this.user = response.data;
      } catch (error) {
        console.error('åŠ è½½ç”¨æˆ·ä¿¡æ¯å¤±è´¥:', error);
      }
    },
  },
};
</script>

<template>
  <div>
    <div v-if="user">
      <p>æ¬¢è¿, {{ user.nickname || user.username }}</p>
      <p>è§’è‰²: {{ user.role }}</p>
    </div>
  </div>
</template>
```

---

## ğŸ“Š æ€§èƒ½å¯¹æ¯”

| æ¥å£            | å“åº”å¤§å° | æ•°æ®åº“æŸ¥è¯¢             | é€‚ç”¨åœºæ™¯         |
| --------------- | -------- | ---------------------- | ---------------- |
| `/user/profile` | ~2KB     | å®Œæ•´ç”¨æˆ·ä¿¡æ¯æŸ¥è¯¢       | è¯¦ç»†èµ„æ–™é¡µé¢     |
| `/user/me`      | ~500B    | å®Œæ•´ç”¨æˆ·ä¿¡æ¯æŸ¥è¯¢åè¿‡æ»¤ | å¯¼èˆªæ ã€å¿«é€Ÿæ£€æŸ¥ |

---

## ğŸ” å®‰å…¨æ³¨æ„äº‹é¡¹

1. **Token ä¿æŠ¤**
   - ä¸è¦åœ¨å‰ç«¯ä»£ç ä¸­ç¡¬ç¼–ç  Token
   - ä½¿ç”¨å®‰å…¨çš„æ–¹å¼å­˜å‚¨ Token(å¦‚ httpOnly Cookie æˆ–å®‰å…¨çš„ localStorage)
   - åœ¨ç”¨æˆ·é€€å‡ºç™»å½•æ—¶æ¸…é™¤ Token

2. **æ•æ„Ÿä¿¡æ¯**
   - `password` å­—æ®µä¸ä¼šåœ¨å“åº”ä¸­è¿”å›
   - æ‰€æœ‰æ•æ„Ÿæ“ä½œéƒ½éœ€è¦é‡æ–°éªŒè¯å¯†ç 
   - å®šæœŸæ›´æ–° Token è¿‡æœŸæ—¶é—´

3. **æƒé™æ£€æŸ¥**
   - æ¥å£ä¼šè‡ªåŠ¨éªŒè¯ JWT Token çš„æœ‰æ•ˆæ€§
   - Token è¿‡æœŸåéœ€è¦é‡æ–°ç™»å½•
   - ç¦ç”¨ç”¨æˆ·æ— æ³•è®¿é—®ä»»ä½•æ¥å£

---

## ğŸ› å¸¸è§é—®é¢˜

### Q: ä¸ºä»€ä¹ˆè¿”å›çš„ç”¨æˆ·ä¿¡æ¯ä¸å®Œæ•´ï¼Ÿ

A: æ£€æŸ¥ç”¨æˆ·è´¦æˆ·æ˜¯å¦å®Œæ•´å¡«å†™äº†æ‰€æœ‰å­—æ®µï¼ŒæŸäº›å­—æ®µå¯èƒ½ä¸º null æˆ– undefinedã€‚

### Q: å¦‚ä½•æ›´æ–°ç”¨æˆ·ä¿¡æ¯ï¼Ÿ

A: ä½¿ç”¨ `PATCH /user/:id` æ¥å£æ›´æ–°ç”¨æˆ·ä¿¡æ¯(éœ€è¦ç›¸åº”æƒé™)ã€‚

### Q: Token è¿‡æœŸäº†æ€ä¹ˆåŠï¼Ÿ

A: Token è¿‡æœŸåéœ€è¦é‡æ–°ç™»å½•ï¼Œç³»ç»Ÿä¼šè¿”å› 401 é”™è¯¯ã€‚

### Q: å¯ä»¥æ‰¹é‡è·å–å¤šä¸ªç”¨æˆ·ä¿¡æ¯å—ï¼Ÿ

A: ä¸å¯ä»¥ï¼Œæ¯ä¸ªæ¥å£åªèƒ½è·å–å½“å‰ç™»å½•ç”¨æˆ·çš„ä¿¡æ¯ã€‚è·å–å…¶ä»–ç”¨æˆ·ä¿¡æ¯éœ€è¦ä½¿ç”¨ `GET /user/:id` æ¥å£ã€‚

---

## ğŸ“ æ›´æ–°è®°å½•

- **2025-11-08**: æ·»åŠ è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯æ¥å£
- **2025-11-08**: å®Œå–„æ¥å£æ–‡æ¡£å’Œç¤ºä¾‹
- **2025-11-08**: æ·»åŠ ç®€åŒ–ç‰ˆæ¥å£ `/user/me`

---

## ğŸ¯ æ€»ç»“

ç³»ç»Ÿæä¾›äº†ä¸¤ä¸ªè·å–å½“å‰ç”¨æˆ·ä¿¡æ¯çš„æ¥å£:

1. **`/user/profile`** - è·å–å®Œæ•´ç”¨æˆ·ä¿¡æ¯ï¼Œé€‚ç”¨äºéœ€è¦è¯¦ç»†ç”¨æˆ·èµ„æ–™çš„åœºæ™¯
2. **`/user/me`** - è·å–ç®€åŒ–ç”¨æˆ·ä¿¡æ¯ï¼Œé€‚ç”¨äºå¿«é€Ÿæ˜¾ç¤ºå’ŒçŠ¶æ€æ£€æŸ¥

ä¸¤ä¸ªæ¥å£éƒ½éœ€è¦ JWT è®¤è¯ï¼Œè¿”å›çš„å“åº”æ ¼å¼æ¸…æ™°ï¼Œä¾¿äºå‰ç«¯ä½¿ç”¨ã€‚
