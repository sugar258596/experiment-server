# 动态功能说明

## 功能概述

将原有的"新闻公告"功能改造为"动态"功能，增加了以下特性：

### 1. 权限控制
- **发布权限**：只有老师和管理员可以发布动态
- **点赞和收藏**：所有登录用户（学生、老师）都可以点赞和收藏动态

### 2. 核心功能

#### 动态发布
- 老师和管理员可以发布动态
- 支持上传封面图片和最多10张动态图片
- 支持添加标签

#### 点赞功能
- 用户可以对动态进行点赞/取消点赞
- 点赞状态实时更新
- 显示点赞总数

#### 收藏功能
- 用户可以收藏/取消收藏动态
- 收藏状态实时更新
- 显示收藏总数

#### 个人中心展示
- 新增"点赞的动态"标签页：展示用户点赞过的所有动态
- 新增"收藏的动态"标签页：展示用户收藏的所有动态
- 支持分页浏览
- 显示点赞/收藏时间

## 数据库变更

### 新增表

#### news_likes (点赞记录表)
- id: 主键
- userId: 用户ID
- newsId: 动态ID
- createdAt: 点赞时间
- deletedAt: 软删除时间
- 唯一索引: (userId, newsId)

#### news_favorites (收藏记录表)
- id: 主键
- userId: 用户ID
- newsId: 动态ID
- createdAt: 收藏时间
- deletedAt: 软删除时间
- 唯一索引: (userId, newsId)

### 更新表

#### news (动态表)
- 新增字段 `favorites`: 收藏数统计

## API 接口

### 动态相关

#### GET /api/news
获取动态列表（公开访问）
- 返回数据包含当前用户的点赞和收藏状态

#### GET /api/news/:id
获取动态详情（公开访问）
- 返回数据包含当前用户的点赞和收藏状态

#### POST /api/news
发布动态（需要老师或管理员权限）

#### PUT /api/news/:id
更新动态（需要作者或管理员权限）

#### DELETE /api/news/:id
删除动态（需要作者或管理员权限）

### 点赞和收藏

#### POST /api/news/:id/like
切换点赞状态（需要登录）
- 如果已点赞则取消，未点赞则添加
- 返回: { success, isLiked, message }

#### POST /api/news/:id/favorite
切换收藏状态（需要登录）
- 如果已收藏则取消，未收藏则添加
- 返回: { success, isFavorited, message }

#### GET /api/news/my/likes
获取我点赞的动态（需要登录）
- 支持分页: page, pageSize

#### GET /api/news/my/favorites
获取我收藏的动态（需要登录）
- 支持分页: page, pageSize

## 前端页面

### 动态列表页 (/news)
- 显示所有动态
- 每条动态显示点赞数和收藏数
- 提供点赞和收藏按钮
- 老师和管理员可以看到"发布动态"按钮

### 动态详情页 (/news/:id)
- 显示动态完整内容
- 显示封面图片和动态图片
- 提供点赞和收藏按钮
- 作者或管理员可以编辑和删除

### 个人中心
- 学生和老师都有"点赞的动态"和"收藏的动态"标签页
- 显示点赞/收藏时间
- 支持分页浏览
- 点击可跳转到动态详情

## 使用说明

### 发布动态
1. 以老师或管理员身份登录
2. 进入动态页面
3. 点击"发布动态"按钮
4. 填写标题、内容，上传图片
5. 提交发布

### 点赞和收藏
1. 在动态列表或详情页
2. 点击"点赞"或"收藏"按钮
3. 再次点击可取消

### 查看我的点赞和收藏
1. 进入个人中心
2. 切换到"点赞的动态"或"收藏的动态"标签页
3. 浏览已点赞或收藏的动态

## 注意事项

1. 数据库会自动同步创建新表
2. 点赞和收藏使用唯一索引防止重复
3. 所有操作都有权限验证
4. 支持软删除，数据可恢复
