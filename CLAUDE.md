# CLAUDE.md

本文件用于为 **Claude Code**（[claude.ai/code](https://claude.ai/code)）提供在本项目中编写和维护代码的开发指引。

---

## 一、项目概述

本项目是一个基于 **NestJS** 的 **高校实验室预约管理系统（University Laboratory Reservation Management System）**。
系统提供数字化实验室管理能力，支持学生预约、教师审核以及管理员管理等功能。

---

## 二、技术栈

- **后端框架**：NestJS 10.x
- **数据库**：MySQL 8.0.x（使用 TypeORM）
- **认证机制**：JWT（结合 bcryptjs）
- **数据验证**：class-validator 与 class-transformer
- **语言**：TypeScript **禁止使用any**
- **包管理器**：⚙️ **pnpm（强制使用）**

> ⚠️ **严格强制要求**
>
> - 所有开发者**必须**使用 **pnpm** 进行依赖管理
> - **禁止**使用 npm 或 yarn
> - 项目已根据 pnpm 的锁定文件与工作区行为进行优化
> - **每次修改代码后必须执行** `pnpm run lint` 进行代码质量检查

---

## 三、开发命令

### 启动项目

```bash
# 开发模式（热更新）
pnpm start:dev

# 构建并启动生产环境
pnpm build
pnpm start:prod
```

### 测试命令

```bash
# 运行全部测试
pnpm test

# 监听模式
pnpm test:watch

# 生成覆盖率报告
pnpm test:cov

# 端到端测试（E2E）
pnpm test:e2e

# 调试测试
pnpm test:debug
```

### 代码质量（**必须执行**）

```bash
# ⚠️ 每次修改代码后必须执行此命令
# 执行 Lint 并自动修复（强制要求）
pnpm lint

# 使用 Prettier 格式化代码
pnpm format
```

> ✅ **开发流程规范**：
>
> 1. 修改代码
> 2. 执行 `pnpm run lint`（强制要求）
> 3. 确保通过所有 lint 检查
> 4. 提交代码

---

## 四、系统架构

### 模块化结构

本项目采用 **模块化架构**，共包含 9 个主要功能模块（见 `src/app.module.ts` 第 18–40 行）：

1. **UserModule** – 用户管理（学生、教师、管理员）
2. **AuthModule** – 登录认证与 JWT 令牌管理
3. **LabModule** – 实验室信息管理
4. **InstrumentModule** – 仪器设备管理与申请流程
5. **AppointmentModule** – 实验室预约系统
6. **NewsModule** – 实验室公告与动态
7. **NotificationModule** – 消息通知模块
8. **FavoritesModule** – 用户收藏模块
9. **EvaluationModule** – 实验室与设备评价模块

---

## 五、配置文件说明

**数据库配置**（`src/config/mysql.config.ts`）：

- 使用 MySQL 8.0 + TypeORM
- 开发环境启用自动同步（`synchronize: true`）
- 自动加载实体（`autoLoadEntities: true`）
- 含连接重试机制
- 时区设置为 `+08:00`（Asia/Shanghai）

**环境变量示例**（`.env.example`）：

```env
DB_HOST=localhost
DB_PORT=3306
DB_USERNAME=root
DB_PASSWORD=your_password
DB_DATABASE=lab_management
JWT_SECRET=your-secret-key-change-this-in-production
```

---

## 六、认证流程

系统使用 JWT 认证机制（`src/auth/auth.service.ts`）：

1. **注册**（`auth.service.ts:18`）
   - 检查用户名唯一性
   - 使用 bcrypt 进行密码加密（10 轮盐值）
   - 创建用户并分配角色

2. **登录**（`auth.service.ts:55`）
   - 根据用户名查找用户
   - 验证密码与账户状态
   - 生成 JWT Token

3. **令牌结构**
   包含：`username`、`sub`（用户ID）与 `role`

用户角色包括：`STUDENT`（学生）、`TEACHER`（教师）、`ADMIN`（管理员）

---

## 七、模块说明

### 通用模式

每个模块均遵循 NestJS 最佳实践：

- **Controller**：处理 HTTP 请求与响应
- **Service**：封装业务逻辑
- **Entity**：TypeORM 实体模型
- **DTO**：数据传输与验证对象

---

### 用户管理模块（UserModule）

`src/user/entities/user.entity.ts`：

- 用户基本信息（用户名、邮箱、手机号）
- 基于角色的访问控制
- 账户状态（ACTIVE / DISABLED）

---

### 实验室与预约模块（AppointmentModule）

`src/appointment/` 目录：

- 学生与教师可发起预约
- 教师可审批预约申请
- 支持多时段（上午/下午/晚上）预约
- 状态管理：`PENDING`、`APPROVED`、`REJECTED`、`COMPLETED`、`CANCELLED`

---

### 仪器设备模块（InstrumentModule）

主要功能：

- 管理仪器/设备信息
- 仪器使用申请与维修申请
- 仪器状态更新与追踪

---

## 八、开发环境搭建步骤

1. **安装依赖**

   ```bash
   pnpm install
   ```

2. **配置数据库（MySQL 8.0+）**
   - 创建数据库 `lab_management`
   - 在 `.env` 中填写正确的数据库连接信息
   - 开发环境下 TypeORM 自动同步实体结构

3. **启动开发服务器**

   ```bash
   pnpm start:dev
   ```

---

## 九、测试

测试文件统一使用 `.spec.ts` 后缀。
示例：

- `src/user/user.controller.spec.ts`
- `src/user/user.service.spec.ts`
- `src/app.controller.spec.ts`

运行指定测试文件：

```bash
pnpm test -- user.service.spec.ts
```

---

## 十、代码质量规范

### Lint 检查（强制要求）

**每次修改代码后必须执行：**

```bash
pnpm lint
```

> ⚠️ **重要说明**：
>
> - 提交代码前必须通过 lint 检查
> - lint 检查包括 ESLint 规则和代码格式化
> - 使用 `--fix` 参数自动修复可修复的问题
> - 不可修复的问题需要手动调整代码

### 开发工作流程

1. **编写代码**
2. **运行 lint 检查**：`pnpm run lint`（必须）
3. **修复所有 lint 错误**
4. **测试功能**：确保测试通过
5. **提交代码**：仅在通过 lint 检查后提交

---

## 十一、注意事项

- **开发环境** 开启 TypeORM 自动同步（生产环境需关闭）
- JWT Token 内包含用户角色信息，用于权限判断
- 所有时间戳统一使用 `Asia/Shanghai (+08:00)` 时区
- 密码使用 bcrypt 加密（10 轮盐值）
- 系统遵循 **RESTful API** 设计规范
- **严格禁止使用 npm 或 yarn**，所有依赖管理必须通过 pnpm

---

## 十二、API 路由结构

| 模块       | 路由前缀         | 功能描述       |
| :--------- | :--------------- | :------------- |
| 用户模块   | `/users`         | 用户管理       |
| 认证模块   | `/auth`          | 登录与注册     |
| 实验室模块 | `/labs`          | 实验室操作     |
| 仪器模块   | `/instruments`   | 仪器管理       |
| 预约模块   | `/appointments`  | 实验室预约     |
| 公告模块   | `/news`          | 新闻公告       |
| 通知模块   | `/notifications` | 用户通知       |
| 收藏模块   | `/favorites`     | 用户收藏       |
| 评价模块   | `/evaluations`   | 用户评价与评分 |

---

## 十三、常见问题与解决方案

| 问题             | 可能原因                           | 解决方案                                  |
| :--------------- | :--------------------------------- | :---------------------------------------- |
| 无法连接数据库   | `.env` 配置错误或 MySQL 未启动     | 检查数据库连接信息并启动服务              |
| JWT 报错         | `JWT_SECRET` 未设置或不一致        | 确认 `.env` 文件中密钥一致                |
| TypeORM 同步异常 | 生产环境启用了 `synchronize: true` | 禁用自动同步并使用 migration              |
| 模块导入错误     | 未在 `app.module.ts` 注册模块      | 确认模块已正确引入                        |
| 包版本冲突       | 使用了 npm/yarn 安装依赖           | 删除 `node_modules` 并使用 `pnpm install` |
| Lint 检查失败    | 代码不符合 ESLint 规范             | 运行 `pnpm lint` 并修复所有错误           |

---

## 十四、包管理器规范（强制执行）

### 严格使用 pnpm

项目**强制**使用 pnpm 管理依赖。请确保系统中已安装 pnpm 9.0.0 或更高版本。

#### 安装 pnpm（如未安装）

```bash
npm install -g pnpm@latest
```

#### package.json 配置

项目 `package.json` 中包含以下强制配置：

```json
{
  "engines": {
    "pnpm": ">=9.0.0"
  },
  "packageManager": "pnpm@9.0.0"
}
```

#### 依赖安装

```bash
# ✅ 正确方式
pnpm install

# ❌ 错误方式（严格禁止）
npm install
yarn install
```

#### 错误恢复流程

如误用 npm/yarn 安装依赖，请执行以下操作：

```bash
# 删除错误的锁定文件和依赖
rm -rf node_modules package-lock.json yarn.lock

# 重新安装
pnpm install
```

---

## 十五、开发流程检查清单

在每次提交代码前，请确认以下所有项目：

- [ ] 代码已修改完成
- [ ] 执行了 `pnpm run lint` 命令
- [ ] 所有 lint 检查通过（无错误或警告）
- [ ] 所有测试通过 `pnpm test`
- [ ] 功能测试正常
- [ ] 使用 `pnpm` 管理所有依赖（未使用 npm/yarn）
- [ ] 代码符合项目的 TypeScript 和 NestJS 规范

---

## 十六、联系与支持

如遇到问题，请检查：

1. 是否正确使用 pnpm
2. 是否执行了 `pnpm run lint`
3. 是否已解决所有 lint 错误
4. 依赖是否正确安装

严格遵循以上规范，确保代码质量和团队协作效率。


# 高校实验室预约管理系统需求文档

## 1. 项目概述

### 1.1 项目背景
高校实验室预约管理系统是一个基于 NestJS 开发的综合性实验室管理平台，旨在为高校师生提供数字化实验室预约、设备申请、消息通知等一站式服务。

### 1.2 项目目标
- 提供统一的实验室预约管理平台
- 支持多角色用户管理（学生、教师、管理员）
- 实现实验室资源的有效利用
- 提供设备使用申请和维修管理
- 建设实验室评价体系

### 1.3 核心价值
- **数字化管理**：实现实验室预约、审核、使用的全流程数字化
- **资源优化**：通过科学的管理提高实验室利用率
- **用户体验**：提供直观的界面和便捷的操作流程
- **安全保障**：完善的用户认证和权限管理机制

## 2. 功能需求

### 2.1 用户管理模块

#### 2.1.1 用户注册与登录
- 用户注册（支持用户名、邮箱、手机号）
- JWT 令牌认证登录
- 密码安全加密存储（bcrypt）
- 账户状态管理

#### 2.1.2 用户信息管理
- 个人信息编辑（昵称、头像、邮箱、手机号）
- 所属院系/部门管理
- 教学标签配置
- 审核时间段设置

#### 2.1.3 角色权限
- **学生（STUDENT）**：基础预约、收藏、评价功能
- **教师（TEACHER）**：预约审核、仪器申请、仪器维修报告
- **管理员（ADMIN）**：全系统管理权限
- **超级管理员（SUPER_ADMIN）**：系统级管理权限

### 2.2 实验室管理模块

#### 2.2.1 实验室信息
- 实验室基本信息（名称、位置、容量、描述）
- 实验室图片管理
- 设备清单配置
- 实验室标签分类
- 所属院系管理

#### 2.2.2 实验室状态
- **正常状态**：可正常预约使用
- **维护状态**：临时维护，暂停预约
- **停用状态**：永久停用，停止服务

#### 2.2.3 实验室评价
- 1-5 星评分系统
- 文字评价内容
- 评价统计分析
- 历史评价记录

### 2.3 预约管理模块

#### 2.3.1 预约功能
- 实验室预约申请
- 多时间段支持：
  - 上午时段（8:00-12:00）
  - 下午时段（14:00-18:00）
  - 晚上时段（19:00-22:00）
- 预约原因说明
- 预约时间冲突检测

#### 2.3.2 预约审核
- 待审核预约列表
- 教师/管理员审核功能
- 审核通过/拒绝操作
- 审核意见记录
- 审核历史追踪

#### 2.3.3 预约管理
- 个人预约记录查询
- 预约状态跟踪
- 预约取消功能
- 预约完成标记
- 预约统计分析

### 2.4 仪器设备管理模块

#### 2.4.1 仪器信息
- 仪器基本信息管理
- 仪器所属实验室关联
- 仪器图片和说明书
- 仪器使用说明
- 仪器状态监控

#### 2.4.2 仪器使用申请
- 仪器使用申请提交
- 申请时间选择
- 申请理由说明
- 使用计划描述
- 申请状态跟踪

#### 2.4.3 仪器审核
- 使用申请审核
- 审核时间安排
- 审核意见记录
- 申请历史管理

#### 2.4.4 仪器维修
- 故障报告提交
- 故障类型分类：
  - 硬件故障
  - 软件故障
  - 操作错误
  - 其他原因
- 紧急程度设置：
  - 低
  - 中
  - 高
  - 紧急
- 维修状态跟踪：
  - 待处理
  - 维修中
  - 已完成
- 维修记录管理

### 2.5 新闻公告模块

#### 2.5.1 新闻发布
- 新闻内容编辑
- 新闻图片上传
- 新闻分类管理
- 发布时间设置
- 审核状态管理

#### 2.5.2 新闻审核
- 待审核新闻列表
- 新闻内容审核
- 审核通过/拒绝
- 审核意见记录

#### 2.5.3 新闻管理
- 新闻列表查看
- 新闻详情浏览
- 新闻点赞功能
- 新闻分类筛选
- 新闻搜索功能

### 2.6 收藏管理模块

#### 2.6.1 收藏功能
- 实验室收藏/取消收藏
- 收藏列表管理
- 收藏状态显示
- 收藏数量统计

### 2.7 评价系统模块

#### 2.7.1 实验室评价
- 星级评分（1-5星）
- 评价内容编写
- 评价提交
- 评价修改
- 评价删除

#### 2.7.2 评价统计
- 评价数量统计
- 平均评分计算
- 评分分布分析
- 评价趋势分析

### 2.8 通知消息模块

#### 2.8.1 消息类型
- 预约审核结果通知
- 仪器申请状态通知
- 维修进度通知
- 系统公告通知
- 点赞互动通知

#### 2.8.2 消息管理
- 消息列表查看
- 消息状态标记
- 消息删除功能
- 消息搜索功能

## 3. 技术需求

### 3.1 技术架构
- **后端框架**：NestJS 10.x
- **数据库**：MySQL 8.0+
- **ORM**：TypeORM
- **认证机制**：JWT + bcryptjs
- **数据验证**：class-validator + class-transformer
- **接口文档**：Swagger/OpenAPI
- **开发语言**：TypeScript（严格禁止使用 any）

### 3.2 性能要求
- **响应时间**：API 响应时间 < 500ms
- **并发处理**：支持 100+ 并发用户
- **数据处理**：支持 10,000+ 用户数据
- **可用性**：系统可用性 ≥ 99.5%

### 3.3 安全要求
- **用户认证**：JWT Token 认证
- **密码安全**：bcrypt 加密存储
- **权限控制**：基于角色的访问控制（RBAC）
- **数据验证**：严格的输入数据验证
- **异常处理**：全局异常过滤器
- **日志记录**：请求日志和操作日志

### 3.4 数据要求
- **数据一致性**：确保数据完整性和一致性
- **备份恢复**：支持数据备份和恢复
- **数据安全**：敏感数据加密存储
- **时区支持**：统一使用 Asia/Shanghai (+08:00) 时区

## 4. 用户角色和权限

### 4.1 角色定义

#### 4.1.1 学生（STUDENT）
- **权限范围**：个人功能使用
- **主要功能**：
  - 实验室预约申请
  - 仪器使用申请
  - 收藏实验室
  - 提交实验室评价
  - 查看新闻公告
  - 接收消息通知
  - 报告仪器故障

#### 4.1.2 教师（TEACHER）
- **权限范围**：学生功能 + 审核管理
- **额外功能**：
  - 审核实验室预约
  - 审核仪器使用申请
  - 审核时间段配置
  - 教学标签设置
  - 发布实验室新闻

#### 4.1.3 管理员（ADMIN）
- **权限范围**：教师功能 + 全面管理
- **额外功能**：
  - 实验室信息管理
  - 仪器设备管理
  - 新闻审核发布
  - 用户账户管理
  - 维修状态更新
  - 系统统计分析

#### 4.1.4 超级管理员（SUPER_ADMIN）
- **权限范围**：系统级最高权限
- **额外功能**：
  - 系统配置管理
  - 数据备份恢复
  - 系统监控
  - 权限分配管理

### 4.2 权限验证机制

#### 4.2.1 JWT Token 验证
- Token 包含用户基本信息：username, sub (用户ID), role, email, status
- Token 过期时间：24小时
- 自动刷新机制

#### 4.2.2 角色权限守卫
- 路由级别的权限控制
- API 接口权限验证
- 操作级别的权限检查

## 5. API 接口规范

### 5.1 接口前缀
- **用户模块**：`/users`
- **认证模块**：`/auth`
- **实验室模块**：`/labs`
- **仪器模块**：`/instruments`
- **预约模块**：`/appointments`
- **新闻模块**：`/news`
- **通知模块**：`/notifications`
- **收藏模块**：`/favorites`
- **评价模块**：`/evaluations`

### 5.2 认证方式
- **认证头**：Authorization: Bearer {token}
- **公开接口**：无需认证的查询接口
- **私有接口**：需要 JWT 认证的接口

### 5.3 响应格式
```json
{
  "success": true,
  "message": "操作成功",
  "data": {},
  "timestamp": "2025-11-07T21:40:00.000Z"
}
```

## 6. 数据模型

### 6.1 用户表（users）
- **id**：主键，用户唯一标识
- **username**：用户名（唯一）
- **password**：密码（bcrypt 加密）
- **role**：用户角色
- **status**：用户状态
- **nickname**：用户昵称
- **avatar**：用户头像URL
- **email**：用户邮箱
- **phone**：用户手机号
- **department**：所属院系/部门
- **teachingTags**：教学标签数组
- **auditTimeSlots**：审核时间段配置
- **createdAt**：创建时间
- **updatedAt**：更新时间

### 6.2 实验室表（labs）
- **id**：主键，实验室唯一标识
- **name**：实验室名称
- **location**：实验室位置
- **capacity**：实验室容量
- **description**：实验室描述
- **images**：实验室图片URL数组
- **status**：实验室状态
- **department**：所属院系/部门
- **equipmentList**：设备清单数组
- **tags**：实验室标签数组
- **rating**：实验室评分
- **createdAt**：创建时间
- **updatedAt**：更新时间

### 6.3 预约表（appointments）
- **id**：主键，预约唯一标识
- **userId**：用户ID（外键）
- **labId**：实验室ID（外键）
- **date**：预约日期
- **timeSlot**：预约时间段
- **reason**：预约原因
- **status**：预约状态
- **reviewedBy**：审核人ID
- **reviewTime**：审核时间
- **reviewComment**：审核意见
- **createdAt**：创建时间
- **updatedAt**：更新时间

### 6.4 仪器表（instruments）
- **id**：主键，仪器唯一标识
- **name**：仪器名称
- **labId**：所属实验室ID（外键）
- **description**：仪器描述
- **specifications**：仪器规格
- **status**：仪器状态
- **image**：仪器图片URL
- **manual**：使用说明URL
- **createdAt**：创建时间
- **updatedAt**：更新时间

### 6.5 新闻表（news）
- **id**：主键，新闻唯一标识
- **title**：新闻标题
- **content**：新闻内容
- **authorId**：作者ID（外键）
- **status**：新闻状态
- **imageUrls**：图片URL数组
- **reviewerId**：审核人ID
- **reviewTime**：审核时间
- **likes**：点赞数量
- **createdAt**：创建时间
- **updatedAt**：更新时间

### 6.6 评价表（evaluations）
- **id**：主键，评价唯一标识
- **userId**：用户ID（外键）
- **labId**：实验室ID（外键）
- **rating**：评分（1-5）
- **content**：评价内容
- **createdAt**：创建时间
- **updatedAt**：更新时间

### 6.7 收藏表（favorites）
- **id**：主键，收藏唯一标识
- **userId**：用户ID（外键）
- **labId**：实验室ID（外键）
- **createdAt**：创建时间

### 6.8 通知表（notifications）
- **id**：主键，通知唯一标识
- **userId**：用户ID（外键）
- **title**：通知标题
- **content**：通知内容
- **type**：通知类型
- **read**：已读状态
- **createdAt**：创建时间

### 6.9 仪器申请表（instrument_applications）
- **id**：主键，申请唯一标识
- **applicantId**：申请人ID（外键）
- **instrumentId**：仪器ID（外键）
- **startTime**：使用开始时间
- **endTime**：使用结束时间
- **purpose**：使用目的
- **status**：申请状态
- **reviewedBy**：审核人ID
- **reviewTime**：审核时间
- **reviewComment**：审核意见
- **createdAt**：创建时间
- **updatedAt**：更新时间

### 6.10 仪器维修表（instrument_repairs）
- **id**：主键，维修记录唯一标识
- **instrumentId**：仪器ID（外键）
- **reporterId**：报告人ID（外键）
- **description**：故障描述
- **faultType**：故障类型
- **urgencyLevel**：紧急程度
- **status**：维修状态
- **summary**：维修总结
- **updatedAt**：更新时间
- **createdAt**：创建时间

## 7. 系统架构

### 7.1 总体架构
```
┌─────────────────┐
│   前端界面层     │
│  (Web/移动端)    │
└─────────┬───────┘
          │
┌─────────▼───────┐
│   API 网关层     │
│   (NestJS)      │
└─────────┬───────┘
          │
┌─────────▼───────┐
│   业务逻辑层     │
│   (Services)    │
└─────────┬───────┘
          │
┌─────────▼───────┐
│   数据访问层     │
│   (TypeORM)     │
└─────────┬───────┘
          │
┌─────────▼───────┐
│   数据库层       │
│    (MySQL)      │
└─────────────────┘
```

### 7.2 模块架构
- **UserModule**：用户管理模块
- **AuthModule**：认证授权模块
- **LabModule**：实验室管理模块
- **InstrumentModule**：仪器管理模块
- **AppointmentModule**：预约管理模块
- **NewsModule**：新闻管理模块
- **NotificationModule**：通知消息模块
- **FavoritesModule**：收藏管理模块
- **EvaluationModule**：评价系统模块

### 7.3 数据流
1. **用户认证流程**：
   用户登录 → 验证用户信息 → 生成 JWT Token → 返回给客户端

2. **预约流程**：
   学生提交预约 → 系统验证 → 保存到数据库 → 通知教师 → 教师审核 → 更新预约状态 → 通知学生

3. **仪器申请流程**：
   提交申请 → 状态检查 → 审核流程 → 结果通知

4. **新闻发布流程**：
   创建新闻 → 待审核状态 → 管理员审核 → 发布或拒绝

## 8. 非功能需求

### 8.1 可用性要求
- **系统可用性**：99.5% 以上
- **响应时间**：日常操作响应时间 < 2秒
- **并发用户数**：支持 100+ 并发用户
- **数据备份**：每日自动备份
- **故障恢复时间**：< 30分钟

### 8.2 可维护性要求
- **代码质量**：通过 ESLint 检查，无语法错误
- **文档完善**：API 文档使用 Swagger 自动生成
- **日志记录**：完整的操作日志和错误日志
- **单元测试**：关键业务逻辑需要单元测试覆盖

### 8.3 可扩展性要求
- **模块化设计**：支持新功能模块的快速集成
- **数据库扩展**：支持分库分表扩展
- **缓存支持**：支持 Redis 等缓存系统扩展
- **负载均衡**：支持多实例部署和负载均衡

### 8.4 兼容性要求
- **数据库兼容性**：MySQL 8.0+ 兼容
- **API 兼容性**：支持 RESTful API 标准
- **时区支持**：统一使用 Asia/Shanghai (+08:00) 时区
- **字符编码**：UTF-8 编码

## 9. 开发环境要求

### 9.1 开发工具
- **Node.js**：16.0+ 版本
- **包管理器**：pnpm 9.0.0+（强制使用）
- **数据库**：MySQL 8.0+
- **开发IDE**：VS Code（推荐）
- **版本控制**：Git

### 9.2 依赖管理
- **强制使用 pnpm**：严格禁止使用 npm 或 yarn
- **版本锁定**：通过 pnpm-lock.yaml 锁定依赖版本
- **包更新**：定期检查和更新依赖包

### 9.3 代码质量
- **ESLint**：代码规范检查
- **Prettier**：代码格式化
- **TypeScript**：类型安全检查
- **Jest**：单元测试框架

## 10. 部署要求

### 10.1 环境配置
- **开发环境**：支持热重载和调试
- **测试环境**：完整的测试数据和环境
- **生产环境**：性能优化和安全加固

### 10.2 环境变量
```
# 数据库配置
DB_HOST=localhost
DB_PORT=3306
DB_USERNAME=root
DB_PASSWORD=your_password
DB_DATABASE=lab_management

# JWT 配置
JWT_SECRET=your-secret-key-change-this-in-production
```

### 10.3 启动命令
```bash
# 开发模式
pnpm start:dev

# 构建生产版本
pnpm build

# 生产环境启动
pnpm start:prod

# 初始化脚本
pnpm run init:admin    # 初始化超级管理员
pnpm run init:education # 初始化教育水平数据
pnpm run init:all      # 初始化所有基础数据
```

## 11. 测试要求

### 11.1 测试类型
- **单元测试**：业务逻辑测试
- **集成测试**：API 接口测试
- **E2E 测试**：端到端测试
- **性能测试**：压力测试和性能测试

### 11.2 测试命令
```bash
# 运行全部测试
pnpm test

# 监听模式测试
pnpm test:watch

# 生成覆盖率报告
pnpm test:cov

# 端到端测试
pnpm test:e2e

# 调试测试
pnpm test:debug
```

### 11.3 测试要求
- **测试覆盖率**：核心业务逻辑测试覆盖率达到 80%+
- **测试通过率**：所有测试用例必须通过
- **测试报告**：生成详细的测试报告

## 12. 风险评估

### 12.1 技术风险
- **数据库性能**：大量并发预约可能导致性能瓶颈
- **安全风险**：JWT Token 泄露可能导致权限提升
- **兼容性风险**：数据库版本升级可能影响系统稳定性

### 12.2 业务风险
- **用户接受度**：新系统可能需要培训用户
- **数据迁移**：从旧系统迁移数据可能存在数据丢失风险
- **用户角色管理**：权限设置不当可能导致功能使用异常

### 12.3 风险缓解措施
- **性能优化**：数据库索引优化、缓存机制
- **安全加固**：Token 过期机制、权限验证
- **数据备份**：定期数据备份和恢复测试
- **用户培训**：提供用户手册和培训材料

## 13. 项目时间表

### 13.1 开发阶段
- **需求分析阶段**：1周
- **系统设计阶段**：1周
- **编码实现阶段**：3-4周
- **测试阶段**：1-2周
- **部署上线阶段**：1周

### 13.2 里程碑节点
- **需求评审通过**：需求分析完成
- **技术方案确认**：系统设计完成
- **核心功能实现**：编码实现阶段完成
- **测试通过**：系统测试完成
- **系统上线**：部署上线完成

## 14. 验收标准

### 14.1 功能验收
- **所有业务功能正常工作**
- **用户角色权限正确实施**
- **数据验证机制有效**
- **异常处理机制完善**

### 14.2 性能验收
- **响应时间满足要求**
- **并发处理能力达标**
- **数据查询效率符合预期**
- **系统稳定性良好**

### 14.3 安全验收
- **用户认证机制安全**
- **权限控制有效**
- **数据传输安全**
- **数据存储安全**

### 14.4 质量验收
- **代码质量通过检查**
- **单元测试覆盖率达到要求**
- **API 文档完整准确**
- **用户体验良好**

## 15. 附录

### 15.1 相关文档
- [系统架构设计文档](./docs/architecture.md)
- [API 接口文档](./docs/api.md)
- [数据库设计文档](./docs/database.md)
- [部署指南](./docs/deployment.md)
- [用户手册](./docs/user-guide.md)

### 15.2 技术参考资料
- [NestJS 官方文档](https://nestjs.com/)
- [TypeORM 官方文档](https://typeorm.io/)
- [JWT 认证指南](https://jwt.io/)
- [MySQL 优化指南](https://dev.mysql.com/doc/)

### 15.3 联系方式
- **项目经理**：待定
- **技术负责人**：待定
- **测试负责人**：待定

---

**文档版本**：v1.0  
**创建日期**：2025-11-07  
**最后更新**：2025-11-07  
**文档状态**：初版
