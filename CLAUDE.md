å¥½çš„ âœ… ä»¥ä¸‹æ˜¯å®Œæ•´ä¸­æ–‡ç‰ˆçš„ **`CLAUDE.md`** æ–‡ä»¶å†…å®¹ï¼Œå†…å®¹å®Œå…¨ä¿ç•™åŽŸæœ‰ç»“æž„ï¼Œå¹¶å°†æ‰€æœ‰è¯´æ˜Žä¸Žå‘½ä»¤ç¿»è¯‘ä¸ºä¸­æ–‡ç‰ˆæœ¬ï¼ŒåŒæ—¶ä¿ç•™æŠ€æœ¯åè¯ï¼ˆå¦‚ NestJSã€JWTã€TypeORM ç­‰ï¼‰ä»¥ä¾¿å¼€å‘è€…å‚è€ƒã€‚
æ–‡ä»¶ç»“å°¾ä¹Ÿä¿ç•™äº†â€œå¼ºåˆ¶ä½¿ç”¨ pnpmâ€çš„è§„èŒƒè¯´æ˜Žã€‚

---

````markdown
# CLAUDE.md

æœ¬æ–‡ä»¶ç”¨äºŽä¸º **Claude Code**ï¼ˆ[claude.ai/code](https://claude.ai/code)ï¼‰æä¾›åœ¨æœ¬é¡¹ç›®ä¸­ç¼–å†™å’Œç»´æŠ¤ä»£ç çš„å¼€å‘æŒ‡å¼•ã€‚

---

## ä¸€ã€é¡¹ç›®æ¦‚è¿°

æœ¬é¡¹ç›®æ˜¯ä¸€ä¸ªåŸºäºŽ **NestJS** çš„ **é«˜æ ¡å®žéªŒå®¤é¢„çº¦ç®¡ç†ç³»ç»Ÿï¼ˆUniversity Laboratory Reservation Management Systemï¼‰**ã€‚  
ç³»ç»Ÿæä¾›æ•°å­—åŒ–å®žéªŒå®¤ç®¡ç†èƒ½åŠ›ï¼Œæ”¯æŒå­¦ç”Ÿé¢„çº¦ã€æ•™å¸ˆå®¡æ ¸ä»¥åŠç®¡ç†å‘˜ç®¡ç†ç­‰åŠŸèƒ½ã€‚

---

## äºŒã€æŠ€æœ¯æ ˆ

- **åŽç«¯æ¡†æž¶**ï¼šNestJS 10.x
- **æ•°æ®åº“**ï¼šMySQL 8.0.xï¼ˆä½¿ç”¨ TypeORMï¼‰
- **è®¤è¯æœºåˆ¶**ï¼šJWTï¼ˆç»“åˆ bcryptjsï¼‰
- **æ•°æ®éªŒè¯**ï¼šclass-validator ä¸Ž class-transformer
- **è¯­è¨€**ï¼šTypeScript
- **åŒ…ç®¡ç†å™¨**ï¼šâš™ï¸ **pnpmï¼ˆå¼ºåˆ¶ä½¿ç”¨ï¼‰**

> âš ï¸ æ‰€æœ‰å¼€å‘è€…å¿…é¡»ä½¿ç”¨ **pnpm** è¿›è¡Œä¾èµ–ç®¡ç†ã€‚  
> é¡¹ç›®å·²æ ¹æ® pnpm çš„é”å®šæ–‡ä»¶ä¸Žå·¥ä½œåŒºè¡Œä¸ºè¿›è¡Œä¼˜åŒ–ã€‚ç¦æ­¢ä½¿ç”¨ npm æˆ– yarnã€‚

---

## ä¸‰ã€å¼€å‘å‘½ä»¤

### å¯åŠ¨é¡¹ç›®

```bash
# å¼€å‘æ¨¡å¼ï¼ˆçƒ­æ›´æ–°ï¼‰
pnpm start:dev

# æž„å»ºå¹¶å¯åŠ¨ç”Ÿäº§çŽ¯å¢ƒ
pnpm build
pnpm start:prod
```
````

### æµ‹è¯•å‘½ä»¤

```bash
# è¿è¡Œå…¨éƒ¨æµ‹è¯•
pnpm test

# ç›‘å¬æ¨¡å¼
pnpm test:watch

# ç”Ÿæˆè¦†ç›–çŽ‡æŠ¥å‘Š
pnpm test:cov

# ç«¯åˆ°ç«¯æµ‹è¯•ï¼ˆE2Eï¼‰
pnpm test:e2e

# è°ƒè¯•æµ‹è¯•
pnpm test:debug
```

### ä»£ç è´¨é‡

```bash
# æ‰§è¡Œ Lint å¹¶è‡ªåŠ¨ä¿®å¤
pnpm lint

# ä½¿ç”¨ Prettier æ ¼å¼åŒ–ä»£ç 
pnpm format
```

---

## å››ã€ç³»ç»Ÿæž¶æž„

### æ¨¡å—åŒ–ç»“æž„

æœ¬é¡¹ç›®é‡‡ç”¨ **æ¨¡å—åŒ–æž¶æž„**ï¼Œå…±åŒ…å« 9 ä¸ªä¸»è¦åŠŸèƒ½æ¨¡å—ï¼ˆè§ `src/app.module.ts` ç¬¬ 18â€“40 è¡Œï¼‰ï¼š

1. **UserModule** â€“ ç”¨æˆ·ç®¡ç†ï¼ˆå­¦ç”Ÿã€æ•™å¸ˆã€ç®¡ç†å‘˜ï¼‰
2. **AuthModule** â€“ ç™»å½•è®¤è¯ä¸Ž JWT ä»¤ç‰Œç®¡ç†
3. **LabModule** â€“ å®žéªŒå®¤ä¿¡æ¯ç®¡ç†
4. **InstrumentModule** â€“ ä»ªå™¨è®¾å¤‡ç®¡ç†ä¸Žç”³è¯·æµç¨‹
5. **AppointmentModule** â€“ å®žéªŒå®¤é¢„çº¦ç³»ç»Ÿ
6. **NewsModule** â€“ å®žéªŒå®¤å…¬å‘Šä¸ŽåŠ¨æ€
7. **NotificationModule** â€“ æ¶ˆæ¯é€šçŸ¥æ¨¡å—
8. **FavoritesModule** â€“ ç”¨æˆ·æ”¶è—æ¨¡å—
9. **EvaluationModule** â€“ å®žéªŒå®¤ä¸Žè®¾å¤‡è¯„ä»·æ¨¡å—

---

## äº”ã€é…ç½®æ–‡ä»¶è¯´æ˜Ž

**æ•°æ®åº“é…ç½®**ï¼ˆ`src/config/mysql.config.ts`ï¼‰ï¼š

- ä½¿ç”¨ MySQL 8.0 + TypeORM
- å¼€å‘çŽ¯å¢ƒå¯ç”¨è‡ªåŠ¨åŒæ­¥ï¼ˆ`synchronize: true`ï¼‰
- è‡ªåŠ¨åŠ è½½å®žä½“ï¼ˆ`autoLoadEntities: true`ï¼‰
- å«è¿žæŽ¥é‡è¯•æœºåˆ¶
- æ—¶åŒºè®¾ç½®ä¸º `+08:00`ï¼ˆAsia/Shanghaiï¼‰

**çŽ¯å¢ƒå˜é‡ç¤ºä¾‹**ï¼ˆ`.env.example`ï¼‰ï¼š

```env
DB_HOST=localhost
DB_PORT=3306
DB_USERNAME=root
DB_PASSWORD=your_password
DB_DATABASE=lab_management
JWT_SECRET=your-secret-key-change-this-in-production
```

---

## å…­ã€è®¤è¯æµç¨‹

ç³»ç»Ÿä½¿ç”¨ JWT è®¤è¯æœºåˆ¶ï¼ˆ`src/auth/auth.service.ts`ï¼‰ï¼š

1. **æ³¨å†Œ**ï¼ˆ`auth.service.ts:18`ï¼‰
   - æ£€æŸ¥ç”¨æˆ·åå”¯ä¸€æ€§
   - ä½¿ç”¨ bcrypt è¿›è¡Œå¯†ç åŠ å¯†ï¼ˆ10 è½®ç›å€¼ï¼‰
   - åˆ›å»ºç”¨æˆ·å¹¶åˆ†é…è§’è‰²

2. **ç™»å½•**ï¼ˆ`auth.service.ts:55`ï¼‰
   - æ ¹æ®ç”¨æˆ·åæŸ¥æ‰¾ç”¨æˆ·
   - éªŒè¯å¯†ç ä¸Žè´¦æˆ·çŠ¶æ€
   - ç”Ÿæˆ JWT Token

3. **ä»¤ç‰Œç»“æž„**
   åŒ…å«ï¼š`username`ã€`sub`ï¼ˆç”¨æˆ·IDï¼‰ä¸Ž `role`

ç”¨æˆ·è§’è‰²åŒ…æ‹¬ï¼š`STUDENT`ï¼ˆå­¦ç”Ÿï¼‰ã€`TEACHER`ï¼ˆæ•™å¸ˆï¼‰ã€`ADMIN`ï¼ˆç®¡ç†å‘˜ï¼‰

---

## ä¸ƒã€æ¨¡å—è¯´æ˜Ž

### é€šç”¨æ¨¡å¼

æ¯ä¸ªæ¨¡å—å‡éµå¾ª NestJS æœ€ä½³å®žè·µï¼š

- **Controller**ï¼šå¤„ç† HTTP è¯·æ±‚ä¸Žå“åº”
- **Service**ï¼šå°è£…ä¸šåŠ¡é€»è¾‘
- **Entity**ï¼šTypeORM å®žä½“æ¨¡åž‹
- **DTO**ï¼šæ•°æ®ä¼ è¾“ä¸ŽéªŒè¯å¯¹è±¡

---

### ç”¨æˆ·ç®¡ç†æ¨¡å—ï¼ˆUserModuleï¼‰

`src/user/entities/user.entity.ts`ï¼š

- ç”¨æˆ·åŸºæœ¬ä¿¡æ¯ï¼ˆç”¨æˆ·åã€é‚®ç®±ã€æ‰‹æœºå·ï¼‰
- åŸºäºŽè§’è‰²çš„è®¿é—®æŽ§åˆ¶
- è´¦æˆ·çŠ¶æ€ï¼ˆACTIVE / DISABLEDï¼‰

---

### å®žéªŒå®¤ä¸Žé¢„çº¦æ¨¡å—ï¼ˆAppointmentModuleï¼‰

`src/appointment/` ç›®å½•ï¼š

- å­¦ç”Ÿä¸Žæ•™å¸ˆå¯å‘èµ·é¢„çº¦
- æ•™å¸ˆå¯å®¡æ‰¹é¢„çº¦ç”³è¯·
- æ”¯æŒå¤šæ—¶æ®µï¼ˆä¸Šåˆ/ä¸‹åˆ/æ™šä¸Šï¼‰é¢„çº¦
- çŠ¶æ€ç®¡ç†ï¼š`PENDING`ã€`APPROVED`ã€`REJECTED`ã€`COMPLETED`ã€`CANCELLED`

---

### ä»ªå™¨è®¾å¤‡æ¨¡å—ï¼ˆInstrumentModuleï¼‰

ä¸»è¦åŠŸèƒ½ï¼š

- ç®¡ç†ä»ªå™¨/è®¾å¤‡ä¿¡æ¯
- ä»ªå™¨ä½¿ç”¨ç”³è¯·ä¸Žç»´ä¿®ç”³è¯·
- ä»ªå™¨çŠ¶æ€æ›´æ–°ä¸Žè¿½è¸ª

---

## å…«ã€å¼€å‘çŽ¯å¢ƒæ­å»ºæ­¥éª¤

1. **å®‰è£…ä¾èµ–**

   ```bash
   pnpm install
   ```

2. **é…ç½®æ•°æ®åº“ï¼ˆMySQL 8.0+ï¼‰**
   - åˆ›å»ºæ•°æ®åº“ `lab_management`
   - åœ¨ `.env` ä¸­å¡«å†™æ­£ç¡®çš„æ•°æ®åº“è¿žæŽ¥ä¿¡æ¯
   - å¼€å‘çŽ¯å¢ƒä¸‹ TypeORM è‡ªåŠ¨åŒæ­¥å®žä½“ç»“æž„

3. **å¯åŠ¨å¼€å‘æœåŠ¡å™¨**

   ```bash
   pnpm start:dev
   ```

---

## ä¹ã€æµ‹è¯•

æµ‹è¯•æ–‡ä»¶ç»Ÿä¸€ä½¿ç”¨ `.spec.ts` åŽç¼€ã€‚
ç¤ºä¾‹ï¼š

- `src/user/user.controller.spec.ts`
- `src/user/user.service.spec.ts`
- `src/app.controller.spec.ts`

è¿è¡ŒæŒ‡å®šæµ‹è¯•æ–‡ä»¶ï¼š

```bash
pnpm test -- user.service.spec.ts
```

---

## åã€æ³¨æ„äº‹é¡¹

- **å¼€å‘çŽ¯å¢ƒ** å¼€å¯ TypeORM è‡ªåŠ¨åŒæ­¥ï¼ˆç”Ÿäº§çŽ¯å¢ƒéœ€å…³é—­ï¼‰ã€‚
- JWT Token å†…åŒ…å«ç”¨æˆ·è§’è‰²ä¿¡æ¯ï¼Œç”¨äºŽæƒé™åˆ¤æ–­ã€‚
- æ‰€æœ‰æ—¶é—´æˆ³ç»Ÿä¸€ä½¿ç”¨ `Asia/Shanghai (+08:00)` æ—¶åŒºã€‚
- å¯†ç ä½¿ç”¨ bcrypt åŠ å¯†ï¼ˆ10 è½®ç›å€¼ï¼‰ã€‚
- ç³»ç»Ÿéµå¾ª **RESTful API** è®¾è®¡è§„èŒƒã€‚

---

## åä¸€ã€API è·¯ç”±ç»“æž„

| æ¨¡å—       | è·¯ç”±å‰ç¼€         | åŠŸèƒ½æè¿°       |
| :--------- | :--------------- | :------------- |
| ç”¨æˆ·æ¨¡å—   | `/users`         | ç”¨æˆ·ç®¡ç†       |
| è®¤è¯æ¨¡å—   | `/auth`          | ç™»å½•ä¸Žæ³¨å†Œ     |
| å®žéªŒå®¤æ¨¡å— | `/labs`          | å®žéªŒå®¤æ“ä½œ     |
| ä»ªå™¨æ¨¡å—   | `/instruments`   | ä»ªå™¨ç®¡ç†       |
| é¢„çº¦æ¨¡å—   | `/appointments`  | å®žéªŒå®¤é¢„çº¦     |
| å…¬å‘Šæ¨¡å—   | `/news`          | æ–°é—»å…¬å‘Š       |
| é€šçŸ¥æ¨¡å—   | `/notifications` | ç”¨æˆ·é€šçŸ¥       |
| æ”¶è—æ¨¡å—   | `/favorites`     | ç”¨æˆ·æ”¶è—       |
| è¯„ä»·æ¨¡å—   | `/evaluations`   | ç”¨æˆ·è¯„ä»·ä¸Žè¯„åˆ† |

---

## åäºŒã€å¸¸è§é—®é¢˜ä¸Žè§£å†³æ–¹æ¡ˆ

| é—®é¢˜             | å¯èƒ½åŽŸå›                            | è§£å†³æ–¹æ¡ˆ                                  |
| :--------------- | :--------------------------------- | :---------------------------------------- |
| æ— æ³•è¿žæŽ¥æ•°æ®åº“   | `.env` é…ç½®é”™è¯¯æˆ– MySQL æœªå¯åŠ¨     | æ£€æŸ¥æ•°æ®åº“è¿žæŽ¥ä¿¡æ¯å¹¶å¯åŠ¨æœåŠ¡              |
| JWT æŠ¥é”™         | `JWT_SECRET` æœªè®¾ç½®æˆ–ä¸ä¸€è‡´        | ç¡®è®¤ `.env` æ–‡ä»¶ä¸­å¯†é’¥ä¸€è‡´                |
| TypeORM åŒæ­¥å¼‚å¸¸ | ç”Ÿäº§çŽ¯å¢ƒå¯ç”¨äº† `synchronize: true` | ç¦ç”¨è‡ªåŠ¨åŒæ­¥å¹¶ä½¿ç”¨ migration              |
| æ¨¡å—å¯¼å…¥é”™è¯¯     | æœªåœ¨ `app.module.ts` æ³¨å†Œæ¨¡å—      | ç¡®è®¤æ¨¡å—å·²æ­£ç¡®å¼•å…¥                        |
| åŒ…ç‰ˆæœ¬å†²çª       | ä½¿ç”¨äº† npm/yarn å®‰è£…ä¾èµ–           | åˆ é™¤ `node_modules` å¹¶ä½¿ç”¨ `pnpm install` |

---

## åä¸‰ã€å¼ºåˆ¶ä½¿ç”¨ pnpm

é¡¹ç›®ä¸¥æ ¼ä½¿ç”¨ pnpm ç®¡ç†ä¾èµ–ã€‚è¯·åœ¨ `package.json` ä¸­ä¿æŒå¦‚ä¸‹é…ç½®ï¼š

```json
{
  "engines": {
    "pnpm": ">=9.0.0"
  },
  "packageManager": "pnpm@9.0.0"
}
```

> ðŸ§© æç¤ºï¼šå¦‚è¯¯ç”¨ npm/yarn å®‰è£…ä¾èµ–ï¼Œè¯·åˆ é™¤ä»¥ä¸‹å†…å®¹åŽé‡æ–°å®‰è£…ï¼š
>
> ```bash
> rm -rf node_modules package-lock.json yarn.lock
> pnpm install
> ```
